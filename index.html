<!DOCTYPE html>
<html>
<head>

	<link rel="icon" type="image/png" href="/uniproject/favicon.png"/>
    <meta charset=utf-8>
    <title>Three.js Blender Geometry App</title>
    <style>
        body { margin: 0; overflow: hidden }
        canvas { width: 100%; height: 100% }
    </style>
</head>

<body>

<script src="/uniproject/three.min.js"> </script>
<script type="module"> 
	
</script>

<script>
	import('/uniproject/OBJLoader.js').then(m => window.module = m).then(() => {window.loader = new window.module.OBJLoader()}).then(() => {
    // Globális változók
    let  WIDTH, HEIGHT, aspectRatio;
    let scene, camera;
    let meshLoaded;
    let renderer;
    let light1;

    window.loader = function() {
        window.loader.load(
            // Forrás URL
            '/uniproject/gatling-gun.obj',
            // Modell betöltése utáni függvény
            function ( loaded ) {
                // A loaded egy THREE.Group objektum lesz, amelynek a gyermeke(i) a mesh(-ek)!
                meshLoaded = loaded;
                meshLoaded.scale.set( 0.04, 0.04, 0.04 );

                // Anyag hozzárendelés
                meshLoaded.traverse( function ( child ) {
                    if ( child instanceof THREE.Mesh ) {
                        mat = new THREE.MeshLambertMaterial( {color: 0x2080f0, side: THREE.DoubleSide} );
                        child.material = mat;
                    }
                } );

                init();
            },
            // Betöltés előrehaladása közben hívódik
            function ( xhr ) {
                console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
            },
            // Hibás betöltés esetén
            function ( error ) {
                console.log( 'An error happened' );
            });
    }

    function init() {
        // Böngésző ablakméret lekérése és méretarány számítása
        HEIGHT = window.innerHeight;
        WIDTH = window.innerWidth;
        aspectRatio = WIDTH / HEIGHT;

        // Színtér létrehozása
        scene = new THREE.Scene();


        // Renderer létrehozása és DOM-hoz adása
        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setSize( WIDTH, HEIGHT );
        renderer.setClearColor( 0x202020 );
        document.body.appendChild( renderer.domElement );

        // Kamera létrehozása és vetítési paramétereinek beállítása
        camera = new THREE.PerspectiveCamera( 75, aspectRatio, 0.1, 1000 );
        //camera.position.z = 25;
        camera.position.set( 25, 25, 25 );

        // Háttérkép létrehozása
        const loader = new THREE.TextureLoader();
        let bgTexture = loader.load('papucsosjeti.jpeg');
        scene.background = bgTexture;

        // Betöltött objektum színtérhez adása
        scene.add( meshLoaded );

        // Fények
        let lightA = new THREE.AmbientLight( 0x404040 );
        scene.add( lightA );

        light1 = new THREE.SpotLight( 0xffffff, 1  );
        light1.position.set( 0, 0, 30 );
        light1.angle = Math.PI / 4;
        scene.add( light1 );
        //var sLH1 = new THREE.SpotLightHelper( light1 );
        //scene.add( sLH1 );

        // Az ablak átméretezése esetén visszahívható függvény megadása
        window.addEventListener( 'resize', handleWindowResize, false );

        camera.lookAt( scene.position );
        // Első képkocka rajzolása
        render();
    }

    function handleWindowResize() {
        // Az ablak átméretezése esetén a kamera vetítési paraméterek újraszámolása
        HEIGHT = window.innerHeight;
        WIDTH = window.innerWidth;
        renderer.setSize( WIDTH, HEIGHT );
        camera.aspect = WIDTH / HEIGHT;
        camera.updateProjectionMatrix();
    }

    let render = function () {
        // Újabb képkocka rajzolásának kérése.
        // Maximálisan 60 FPS-t biztosít a rendszer.
        requestAnimationFrame(render);

        // Objektum elforgatási paraméterének módosítása
        meshLoaded.rotation.x += 0;
        meshLoaded.rotation.y += 0.001;

        // 3D -> 2D vetített kép kiszámítása.
        // scene 3D színtér képe a camera kamera szemszögéből.
        renderer.render(scene, camera);
    };
}).then(() => { window.onload = (event) => {window.loader()}; });
</script>
</body>
</html>
